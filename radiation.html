<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radiation Intensity Lab ‚Äì Geiger Counter Simulation</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      color: #e0e0e0;
      overflow: hidden;
    }

    .app-wrapper {
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Header */
    header {
      background: rgba(10, 14, 39, 0.95);
      border-bottom: 1px solid rgba(0, 153, 102, 0.2);
      padding: 20px;
      text-align: center;
      position: relative;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .header-icon {
      font-size: 32px;
      filter: drop-shadow(0 0 8px rgba(0, 153, 102, 0.4));
    }

    .header-text h1 {
      font-size: 28px;
      font-weight: 700;
      color: #00d966;
      text-shadow: 0 0 10px rgba(0, 153, 102, 0.3);
      letter-spacing: 1px;
    }

    .header-text p {
      font-size: 12px;
      color: #888;
      margin-top: 2px;
      letter-spacing: 0.5px;
    }

    .info-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(0, 153, 102, 0.1);
      border: 2px solid rgba(0, 153, 102, 0.4);
      color: #00d966;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .info-btn:hover {
      background: rgba(0, 153, 102, 0.2);
      box-shadow: 0 0 12px rgba(0, 153, 102, 0.5);
    }

    /* Main container */
    .main-container {
      display: flex;
      flex: 1;
      gap: 20px;
      padding: 20px;
      overflow: hidden;
    }

    /* Left panel */
    .left-panel {
      width: 300px;
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .card {
      background: rgba(20, 25, 45, 0.8);
      border: 1px solid rgba(0, 153, 102, 0.15);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }

    .controls-card {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .controls-card::-webkit-scrollbar {
      width: 6px;
    }

    .controls-card::-webkit-scrollbar-track {
      background: rgba(0, 153, 102, 0.05);
      border-radius: 10px;
    }

    .controls-card::-webkit-scrollbar-thumb {
      background: rgba(0, 153, 102, 0.3);
      border-radius: 10px;
    }

    .controls-card::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 153, 102, 0.5);
    }

    /* Right panel */
    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow: hidden;
    }

    .right-panel .card {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    /* Control section */
    .control-section {
      margin-bottom: 24px;
    }

    .control-section:last-child {
      margin-bottom: 0;
    }

    .control-label {
      font-size: 12px;
      font-weight: 600;
      color: #00d966;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
      display: block;
    }

    /* Dropdown */
    select {
      width: 100%;
      padding: 10px 12px;
      background: rgba(0, 153, 102, 0.1);
      border: 1px solid rgba(0, 153, 102, 0.4);
      border-radius: 6px;
      color: #00d966;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    select option {
      background: rgba(10, 14, 39, 0.95);
      color: #00d966;
    }

    select:hover {
      border-color: rgba(0, 153, 102, 0.8);
      background: rgba(0, 153, 102, 0.15);
      box-shadow: 0 0 8px rgba(0, 153, 102, 0.3);
    }

    select:focus {
      outline: none;
      border-color: #00d966;
      background: rgba(0, 153, 102, 0.2);
      box-shadow: 0 0 12px rgba(0, 153, 102, 0.5);
    }

    /* Mode toggle */
    .mode-toggle {
      display: flex;
      gap: 8px;
    }

    .toggle-btn {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid rgba(0, 153, 102, 0.3);
      background: rgba(0, 153, 102, 0.05);
      color: #888;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .toggle-btn:hover {
      border-color: rgba(0, 153, 102, 0.6);
    }

    .toggle-btn.active {
      background: rgba(0, 153, 102, 0.3);
      color: #00d966;
      border-color: #00d966;
      box-shadow: 0 0 8px rgba(0, 153, 102, 0.4);
    }

    /* Slider */
    .slider-container {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }

    input[type="range"] {
      flex: 1;
      height: 6px;
      border-radius: 3px;
      background: linear-gradient(to right, rgba(0, 153, 102, 0.2), rgba(0, 153, 102, 0.4));
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #00d966;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 153, 102, 0.6);
      transition: all 0.3s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 0 15px rgba(0, 153, 102, 0.8);
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #00d966;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 10px rgba(0, 153, 102, 0.6);
      transition: all 0.3s ease;
    }

    .slider-value {
      min-width: 50px;
      text-align: right;
      font-weight: 600;
      color: #00d966;
      font-size: 13px;
      background: rgba(0, 153, 102, 0.08);
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid rgba(0, 153, 102, 0.2);
    }

    /* Toggle switches */
    .toggle-switch {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: rgba(0, 153, 102, 0.1);
      border: 1px solid rgba(0, 153, 102, 0.3);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .switch.active {
      background: rgba(0, 153, 102, 0.3);
      border-color: #00d966;
    }

    .switch-knob {
      position: absolute;
      width: 20px;
      height: 20px;
      background: rgba(0, 153, 102, 0.5);
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s ease;
    }

    .switch.active .switch-knob {
      left: 22px;
      background: #00d966;
      box-shadow: 0 0 8px rgba(0, 153, 102, 0.6);
    }

    .toggle-label {
      font-size: 13px;
      color: #ccc;
      flex: 1;
      cursor: pointer;
      user-select: none;
    }

    /* Buttons */
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 24px;
    }

    .btn {
      padding: 12px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, rgba(0, 153, 102, 0.3), rgba(0, 153, 102, 0.1));
      border: 1.5px solid #00d966;
      color: #00d966;
      box-shadow: 0 0 12px rgba(0, 153, 102, 0.3);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, rgba(0, 153, 102, 0.4), rgba(0, 153, 102, 0.2));
      box-shadow: 0 0 20px rgba(0, 153, 102, 0.6);
      transform: translateY(-2px);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: rgba(0, 153, 102, 0.08);
      border: 1px solid rgba(0, 153, 102, 0.3);
      color: #aaa;
      flex: 1;
    }

    .btn-secondary:hover {
      background: rgba(0, 153, 102, 0.12);
      border-color: rgba(0, 153, 102, 0.5);
      color: #ccc;
    }

    .button-row {
      display: flex;
      gap: 12px;
    }

    /* Card titles */
    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: #00ff96;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Experimental Setup */
    .setup-diagram {
      display: flex;
      flex-direction: column;
      gap: 20px;
      flex: 1;
    }

    .diagram-visual {
      display: flex;
      align-items: center;
      padding: 30px 20px;
      background: rgba(0, 153, 102, 0.03);
      border-radius: 8px;
      border: 1px solid rgba(0, 153, 102, 0.1);
      min-height: 200px;
      position: relative;
      overflow: hidden;
    }

    .diagram-source {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 10;
      flex-shrink: 0;
    }

    .diagram-detector {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 10;
      position: absolute;
      flex-shrink: 0;
    }

    .diagram-barrier {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 10;
      position: absolute;
      flex-shrink: 0;
    }

    .source-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(200, 50, 255, 0.8), rgba(100, 20, 200, 0.6));
      box-shadow: 0 0 20px rgba(200, 50, 255, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }

    .detector-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(0, 153, 102, 0.2), rgba(0, 153, 102, 0.1));
      border: 2px solid #00d966;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: 0 0 16px rgba(0, 153, 102, 0.5), inset 0 0 8px rgba(0, 153, 102, 0.2);
      position: relative;
    }

    .detector-icon::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 2px solid rgba(0, 153, 102, 0.3);
      animation: pulse-detector 2s ease-in-out infinite;
    }

    @keyframes pulse-detector {
      0%, 100% { transform: scale(1); opacity: 0.3; }
      50% { transform: scale(1.15); opacity: 0; }
    }

    .detector-readout {
      font-size: 13px;
      font-weight: 600;
      color: #00d966;
      background: rgba(0, 153, 102, 0.05);
      padding: 4px 8px;
      border-radius: 3px;
      border: 1px solid rgba(0, 153, 102, 0.2);
      min-width: 80px;
      text-align: center;
    }

    /* Measurement overlay */
    .measurement-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .measurement-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .measurement-modal {
      background: linear-gradient(135deg, rgba(10, 14, 39, 0.95), rgba(20, 25, 60, 0.95));
      border: 2px solid #00d966;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 0 40px rgba(0, 153, 102, 0.5);
      min-width: 300px;
    }

    .measurement-title {
      font-size: 20px;
      font-weight: 700;
      color: #00d966;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .measurement-timer {
      font-size: 48px;
      font-weight: 700;
      color: #00ff96;
      margin-bottom: 20px;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 0 20px rgba(0, 153, 102, 0.6);
    }

    .measurement-stats {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      justify-content: center;
    }

    .stat-box {
      background: rgba(0, 153, 102, 0.1);
      border: 1px solid rgba(0, 153, 102, 0.3);
      border-radius: 8px;
      padding: 12px 16px;
    }

    .stat-label {
      font-size: 11px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 700;
      color: #00d966;
      font-variant-numeric: tabular-nums;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(0, 153, 102, 0.1);
      border-radius: 3px;
      margin-top: 20px;
      overflow: hidden;
      border: 1px solid rgba(0, 153, 102, 0.3);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, #00d966, #00ff96);
      width: 0%;
      transition: width 0.1s linear;
      box-shadow: 0 0 10px rgba(0, 153, 102, 0.6);
    }

    .icon-label {
      font-size: 11px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .barrier-icon {
      width: 40px;
      height: 80px;
      background: linear-gradient(to right, rgba(150, 100, 200, 0.4), rgba(100, 50, 150, 0.6));
      border: 1px solid rgba(150, 100, 200, 0.6);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .emission-line {
      position: absolute;
      height: 2px;
      background: linear-gradient(to right, rgba(0, 255, 150, 0.4), transparent);
      left: 50%;
      transform-origin: left center;
    }

    .emission-line:nth-child(1) {
      width: 120px;
      top: 30%;
      animation: pulse-line 1.5s ease-in-out infinite;
    }

    .emission-line:nth-child(2) {
      width: 140px;
      top: 50%;
      animation: pulse-line 1.5s ease-in-out infinite 0.2s;
    }

    .emission-line:nth-child(3) {
      width: 120px;
      top: 70%;
      animation: pulse-line 1.5s ease-in-out infinite 0.4s;
    }

    @keyframes pulse-line {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.8; }
    }

    .diagram-labels {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #888;
      padding: 0 10px;
    }

    .distance-label {
      text-align: center;
      font-size: 12px;
      color: #00ff96;
      font-weight: 600;
      margin-top: 8px;
    }

    .legend {
      display: flex;
      gap: 16px;
      font-size: 11px;
      color: #888;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .legend-dot.gamma { background: #b366ff; }
    .legend-dot.alpha { background: #ff6b6b; }
    .legend-dot.beta { background: #4ecdc4; }

    /* Chart */
    .chart-container {
      position: relative;
      flex: 1;
      min-height: 0;
    }

    .chart-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #666;
      font-size: 14px;
      text-align: center;
      padding: 20px;
    }

    canvas {
      max-width: 100%;
      max-height: 100%;
    }

    /* Data Table */
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .trial-counter {
      font-size: 12px;
      color: #888;
      background: rgba(0, 255, 150, 0.05);
      padding: 4px 10px;
      border-radius: 4px;
      border: 1px solid rgba(0, 255, 150, 0.2);
    }

    .table-wrapper {
      flex: 1;
      overflow-y: auto;
      border: 1px solid rgba(0, 255, 150, 0.15);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
    }

    .table-wrapper::-webkit-scrollbar {
      width: 6px;
    }

    .table-wrapper::-webkit-scrollbar-track {
      background: rgba(0, 255, 150, 0.05);
    }

    .table-wrapper::-webkit-scrollbar-thumb {
      background: rgba(0, 255, 150, 0.3);
      border-radius: 3px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    thead {
      position: sticky;
      top: 0;
      background: rgba(10, 14, 39, 0.95);
      border-bottom: 2px solid rgba(0, 255, 150, 0.3);
      z-index: 10;
    }

    th {
      padding: 10px 8px;
      text-align: left;
      color: #00ff96;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: rgba(0, 255, 150, 0.05);
    }

    td {
      padding: 8px;
      border-bottom: 1px solid rgba(0, 255, 150, 0.1);
      color: #d0d0d0;
    }

    tbody tr:nth-child(odd) {
      background: rgba(0, 255, 150, 0.02);
    }

    tbody tr:nth-child(even) {
      background: rgba(0, 0, 0, 0.1);
    }

    tbody tr:hover {
      background: rgba(0, 255, 150, 0.08);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 255, 150, 0.2);
      border: 1px solid #00ff96;
      color: #00ff96;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 12px;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 255, 150, 0.3);
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Hidden sections */
    .hidden {
      display: none !important;
    }

    /* Help Modal */
    .help-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(4px);
    }

    .help-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .help-modal {
      background: linear-gradient(135deg, rgba(10, 14, 39, 0.98), rgba(20, 25, 60, 0.98));
      border: 2px solid #00d966;
      border-radius: 12px;
      padding: 0;
      max-width: 800px;
      width: 90%;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 40px rgba(0, 153, 102, 0.5);
    }

    .help-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 2px solid rgba(0, 153, 102, 0.3);
      background: rgba(0, 153, 102, 0.05);
    }

    .help-title {
      font-size: 24px;
      font-weight: 700;
      color: #00ff96;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .help-close {
      background: none;
      border: none;
      color: #00d966;
      font-size: 28px;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .help-close:hover {
      color: #00ff96;
      transform: scale(1.15);
    }

    .help-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .help-content::-webkit-scrollbar {
      width: 6px;
    }

    .help-content::-webkit-scrollbar-track {
      background: rgba(0, 153, 102, 0.05);
    }

    .help-content::-webkit-scrollbar-thumb {
      background: rgba(0, 153, 102, 0.3);
      border-radius: 3px;
    }

    .help-content::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 153, 102, 0.5);
    }

    .help-section {
      margin-bottom: 24px;
    }

    .help-section:last-child {
      margin-bottom: 0;
    }

    .help-section-title {
      font-size: 18px;
      font-weight: 700;
      color: #00ff96;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 14px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 153, 102, 0.2);
    }

    .help-section-content {
      font-size: 15px;
      color: #d0d0d0;
      line-height: 1.8;
    }

    .help-paragraph {
      margin-bottom: 12px;
    }

    .help-list {
      margin-left: 16px;
      margin-bottom: 12px;
    }

    .help-list-item {
      margin-bottom: 8px;
      list-style: none;
      position: relative;
      padding-left: 20px;
    }

    .help-list-item:before {
      content: "‚ñ∏";
      position: absolute;
      left: 0;
      color: #00d966;
      font-weight: bold;
    }

    .help-term {
      color: #00ff96;
      font-weight: 600;
    }

    .help-footer {
      border-top: 1px solid rgba(0, 153, 102, 0.2);
      padding: 16px 24px;
      background: rgba(0, 153, 102, 0.03);
      font-size: 11px;
      color: #888;
      text-align: center;
      letter-spacing: 0.5px;
    }

    /* Responsive adjustments */
    @media (max-width: 1400px) {
      .main-container {
        gap: 16px;
        padding: 16px;
      }

      .left-panel {
        width: 280px;
      }

      .card {
        padding: 16px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-wrapper">
   <header>
    <div class="header-content">
     <div class="header-icon">
      ‚öõÔ∏è
     </div>
     <div class="header-text">
      <h1>Radiation Intensity Lab</h1>
      <p>Geiger Counter Simulation</p>
     </div>
    </div><button class="info-btn" title="Information">‚ÑπÔ∏è</button>
   </header><!-- Help Modal -->
   <div class="help-overlay" id="helpOverlay">
    <div class="help-modal">
     <div class="help-header">
      <div class="help-title">
       üìö Help &amp; Documentation
      </div><button class="help-close" id="helpCloseBtn">√ó</button>
     </div>
     <div class="help-content">
      <div class="help-section">
       <div class="help-section-title">
        About This Application
       </div>
       <div class="help-section-content">
        <div class="help-paragraph">
         The <span class="help-term">Radiation Intensity Lab</span> is an interactive educational simulation of a Geiger counter setup. It allows you to explore how radiation intensity changes with distance and shielding materials. This application demonstrates the inverse square law and how different materials absorb different types of radiation.
        </div>
        <div class="help-paragraph">
         You can collect data by setting up different experimental configurations, measure radiation intensity, and export your findings for analysis.
        </div>
       </div>
      </div>
      <div class="help-section">
       <div class="help-section-title">
        How to Use the Application
       </div>
       <div class="help-section-content">
        <ol class="help-list">
         <li class="help-list-item"><span class="help-term">Choose Radiation Type</span> ‚Äî Select from Alpha (Œ±), Beta (Œ≤), or Gamma (Œ≥) radiation. Different radiation types behave differently with distance and materials.</li>
         <li class="help-list-item"><span class="help-term">Select Experimental Mode</span> ‚Äî Distance Only measures how intensity changes with distance from the source. Barrier Shielding adds a material barrier between the source and detector.</li>
         <li class="help-list-item"><span class="help-term">Adjust Parameters</span> ‚Äî Use the sliders to adjust distance, barrier thickness, or other settings.</li>
         <li class="help-list-item"><span class="help-term">Configure Toggles</span> ‚Äî Enable Background Radiation and Random Fluctuations to simulate realistic detector behavior.</li>
         <li class="help-list-item"><span class="help-term">Set Measurement Time</span> ‚Äî Choose how long the detector collects data (1-20 seconds). Longer times provide more statistical accuracy.</li>
         <li class="help-list-item"><span class="help-term">Collect Data</span> ‚Äî Click "Collect Data" to run an experiment. You'll see a live animation as it counts radiation events.</li>
         <li class="help-list-item"><span class="help-term">Analyze Results</span> ‚Äî View results in the data table and chart showing intensity vs. distance.</li>
         <li class="help-list-item"><span class="help-term">Export Data</span> ‚Äî Click "Export CSV" to download your collected data as a spreadsheet.</li>
        </ol>
       </div>
      </div>
      <div class="help-section">
       <div class="help-section-title">
        Basic Concepts and Terms
       </div>
       <div class="help-section-content">
        <div class="help-paragraph"><span class="help-term">Radiation Types</span>
         <ul class="help-list">
          <li class="help-list-item"><span class="help-term">Alpha (Œ±)</span> ‚Äî Helium nuclei. Easily stopped by paper. Low penetration power.</li>
          <li class="help-list-item"><span class="help-term">Beta (Œ≤)</span> ‚Äî High-speed electrons. Stopped by plastic or aluminum. Medium penetration power.</li>
          <li class="help-list-item"><span class="help-term">Gamma (Œ≥)</span> ‚Äî Electromagnetic radiation. Requires lead for effective shielding. High penetration power.</li>
         </ul>
        </div>
        <div class="help-paragraph"><span class="help-term">Inverse Square Law</span> ‚Äî Radiation intensity decreases with the square of the distance from the source: I ‚àù 1/d¬≤. Doubling the distance reduces intensity to one-quarter.
        </div>
        <div class="help-paragraph"><span class="help-term">Geiger Counter</span> ‚Äî A detector that measures radiation by counting ionization events. "cps" means counts per second‚Äîthe number of radiation events detected.
        </div>
        <div class="help-paragraph"><span class="help-term">Counts Per Second (cps)</span> ‚Äî The measurement unit shown in the detector display. Higher values indicate more radiation detected.
        </div>
        <div class="help-paragraph"><span class="help-term">Background Radiation</span> ‚Äî Ambient radiation from natural sources (cosmic rays, Earth's radioactivity). Present everywhere and adds noise to measurements.
        </div>
        <div class="help-paragraph"><span class="help-term">Shielding</span> ‚Äî A material barrier (paper, plastic, aluminum, or lead) placed between the source and detector to reduce transmitted radiation.
        </div>
        <div class="help-paragraph"><span class="help-term">Corrected cps</span> ‚Äî The measured counts per second minus background radiation. This represents only radiation from the source.
        </div>
        <div class="help-paragraph"><span class="help-term">Statistical Fluctuations</span> ‚Äî Real radiation detection follows Poisson statistics. Repeated measurements vary slightly, simulating realistic detector behavior.
        </div>
       </div>
      </div>
     </div>
     <div class="help-footer">
      Developer: Dr. James Salveo Olarve | Year: 2026
     </div>
    </div>
   </div><!-- Measurement Overlay -->
   <div class="measurement-overlay" id="measurementOverlay">
    <div class="measurement-modal">
     <div class="measurement-title">
      Collecting Data
     </div>
     <div class="measurement-timer" id="measurementTimer">
      0.0s
     </div>
     <div class="measurement-stats">
      <div class="stat-box">
       <div class="stat-label">
        Counts
       </div>
       <div class="stat-value" id="liveCount">
        0
       </div>
      </div>
      <div class="stat-box">
       <div class="stat-label">
        CPS
       </div>
       <div class="stat-value" id="liveCps">
        0.00
       </div>
      </div>
     </div>
     <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
     </div>
    </div>
   </div>
   <div class="main-container"><!-- LEFT PANEL: CONTROLS -->
    <div class="left-panel">
     <div class="card controls-card"><!-- Radiation Type -->
      <div class="control-section"><label class="control-label">Radiation Type</label> <select id="radiationType"> <option value="gamma">Gamma (Œ≥)</option> <option value="alpha">Alpha (Œ±)</option> <option value="beta">Beta (Œ≤)</option> </select>
      </div><!-- Mode -->
      <div class="control-section"><label class="control-label">Mode</label>
       <div class="mode-toggle"><button class="toggle-btn active" data-mode="distance-only">Distance Only</button> <button class="toggle-btn" data-mode="barrier-shielding">Barrier Shielding</button>
       </div>
      </div><!-- Distance Only Controls -->
      <div id="distance-only-controls">
       <div class="control-section"><label class="control-label">Distance (cm)</label>
        <div class="slider-container"><input type="range" id="distanceSlider" min="5" max="50" value="10" step="1">
         <div class="slider-value" id="distanceValue">
          10
         </div>
        </div>
       </div>
       <div class="control-section"><label class="control-label">Measurement Time (s)</label>
        <div class="slider-container"><input type="range" id="timeSlider" min="2" max="20" value="10" step="1">
         <div class="slider-value" id="timeValue">
          10
         </div>
        </div>
       </div>
      </div><!-- Barrier Shielding Controls -->
      <div id="barrier-shielding-controls" class="hidden">
       <div class="control-section"><label class="control-label">Source ‚Üí Barrier (cm)</label>
        <div class="slider-container"><input type="range" id="sourceBarrierSlider" min="5" max="50" value="10" step="1">
         <div class="slider-value" id="sourceBarrierValue">
          10
         </div>
        </div>
       </div>
       <div class="control-section"><label class="control-label">Thickness (mm)</label>
        <div class="slider-container"><input type="range" id="thicknessSlider" min="0" max="20" value="2" step="0.5">
         <div class="slider-value" id="thicknessValue">
          2.0
         </div>
        </div>
       </div>
       <div class="control-section"><label class="control-label">Material</label> <select id="materialSelect"> <option value="paper">Paper (0.70 g/cm¬≥)</option> <option value="plastic">Plastic (1.05 g/cm¬≥)</option> <option value="aluminum">Aluminum (2.70 g/cm¬≥)</option> <option value="lead">Lead (11.34 g/cm¬≥)</option> </select>
       </div>
       <div class="control-section"><label class="control-label">Barrier ‚Üí Detector (cm)</label>
        <div class="slider-container"><input type="range" id="barrierDetectorSlider" min="5" max="50" value="5" step="1">
         <div class="slider-value" id="barrierDetectorValue">
          5
         </div>
        </div>
       </div>
       <div class="control-section"><label class="control-label">Measurement Time (s)</label>
        <div class="slider-container"><input type="range" id="timeSliderBarrier" min="2" max="20" value="5" step="1">
         <div class="slider-value" id="timeValueBarrier">
          5
         </div>
        </div>
       </div>
      </div><!-- Toggles -->
      <div class="control-section">
       <div class="toggle-switch">
        <div class="switch active" id="backgroundToggle">
         <div class="switch-knob"></div>
        </div><label class="toggle-label" for="backgroundToggle">Background Radiation</label>
       </div>
      </div>
      <div class="control-section">
       <div class="toggle-switch">
        <div class="switch active" id="fluctuationsToggle">
         <div class="switch-knob"></div>
        </div><label class="toggle-label" for="fluctuationsToggle">Random Fluctuations</label>
       </div>
      </div><!-- Buttons -->
      <div class="button-group"><button class="btn btn-primary" id="collectDataBtn"> <span>üìä</span> Collect Data </button>
       <div class="button-row"><button class="btn btn-secondary" id="resetBtn">Reset</button> <button class="btn btn-secondary" id="exportBtn">Export CSV</button>
       </div>
      </div>
     </div>
    </div><!-- RIGHT PANEL: CARDS -->
    <div class="right-panel"><!-- Card 1: Experimental Setup -->
     <div class="card">
      <div class="card-title">
       Experimental Setup
      </div>
      <div class="setup-diagram">
       <div class="diagram-visual" id="diagramVisual">
        <div class="diagram-source">
         <div class="source-icon">
          ‚ò¢Ô∏è
         </div>
         <div class="icon-label">
          Source
         </div>
        </div>
        <div class="emission-line"></div>
        <div class="emission-line"></div>
        <div class="emission-line"></div>
        <div class="distance-label" id="distanceLabel">
         10 cm
        </div>
        <div class="diagram-detector">
         <div class="detector-icon">
          üì°
         </div>
         <div class="detector-readout" id="detectorReadout">
          0.00 cps
         </div>
        </div>
       </div>
       <div class="diagram-labels" id="diagramLabels"></div>
       <div class="legend">
        <div class="legend-item">
         <div class="legend-dot gamma"></div><span>Gamma (Œ≥)</span>
        </div>
        <div class="legend-item">
         <div class="legend-dot alpha"></div><span>Alpha (Œ±)</span>
        </div>
        <div class="legend-item">
         <div class="legend-dot beta"></div><span>Beta (Œ≤)</span>
        </div>
       </div>
      </div>
     </div><!-- Card 2: Intensity vs Distance Chart -->
     <div class="card">
      <div class="card-title">
       Intensity vs Distance
      </div>
      <div class="chart-container">
       <div class="chart-placeholder" id="chartPlaceholder">
        Collect data to see the chart
       </div>
       <canvas id="intensityChart" class="hidden"></canvas>
      </div>
     </div><!-- Card 3: Data Table -->
     <div class="card">
      <div class="table-header">
       <div class="card-title">
        Data Table
       </div>
       <div class="trial-counter" id="trialCounter">
        0 trials
       </div>
      </div>
      <div class="table-wrapper">
       <table>
        <thead>
         <tr>
          <th>Trial</th>
          <th>Type</th>
          <th>Mode</th>
          <th>Distance(cm)</th>
          <th>Material</th>
          <th>Thick.(mm)</th>
          <th>Time(s)</th>
          <th>Counts</th>
          <th>cps</th>
          <th>Bkgd(cps)</th>
          <th>Corr. cps</th>
         </tr>
        </thead>
        <tbody id="dataTableBody">
        </tbody>
       </table>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // ==================== PHYSICS CONSTANTS ====================
    const PHYSICS = {
      r0: 10, // reference distance in cm
      background_cps_value: 15.00,

      // Source strength at r0 (cps)
      S0: {
        gamma: 200,
        alpha: 280,
        beta: 180
      },

      // Air attenuation coefficients (cm^-1)
      mu_air: {
        gamma: 0.002,
        alpha: 0.09,
        beta: 0.02
      },

      // Barrier attenuation coefficients (cm^-1)
      mu_barrier: {
        gamma: { paper: 0.02, plastic: 0.05, aluminum: 0.15, lead: 1.20 },
        alpha: { paper: 80, plastic: 150, aluminum: 400, lead: 800 },
        beta: { paper: 0.8, plastic: 2.0, aluminum: 6.0, lead: 12.0 }
      },

      // Alpha range cutoff (cm)
      alpha_range_cutoff: 30
    };

    // ==================== STATE ====================
    let appState = {
      trials: [],
      currentMode: 'distance-only',
      chart: null,
      chartData: { gamma: [], alpha: [], beta: [] }
    };

    // ==================== UI ELEMENTS ====================
    const radiationTypeSelect = document.getElementById('radiationType');
    const modeButtons = document.querySelectorAll('[data-mode]');
    const distanceOnlyControls = document.getElementById('distance-only-controls');
    const barrierShieldingControls = document.getElementById('barrier-shielding-controls');

    // Help elements
    const infoBtn = document.querySelector('.info-btn');
    const helpOverlay = document.getElementById('helpOverlay');
    const helpCloseBtn = document.getElementById('helpCloseBtn');

    // Distance Only sliders
    const distanceSlider = document.getElementById('distanceSlider');
    const distanceValue = document.getElementById('distanceValue');
    const timeSlider = document.getElementById('timeSlider');
    const timeValue = document.getElementById('timeValue');

    // Barrier Shielding sliders
    const sourceBarrierSlider = document.getElementById('sourceBarrierSlider');
    const sourceBarrierValue = document.getElementById('sourceBarrierValue');
    const thicknessSlider = document.getElementById('thicknessSlider');
    const thicknessValue = document.getElementById('thicknessValue');
    const materialSelect = document.getElementById('materialSelect');
    const barrierDetectorSlider = document.getElementById('barrierDetectorSlider');
    const barrierDetectorValue = document.getElementById('barrierDetectorValue');
    const timeSliderBarrier = document.getElementById('timeSliderBarrier');
    const timeValueBarrier = document.getElementById('timeValueBarrier');

    // Toggles
    const backgroundToggle = document.getElementById('backgroundToggle');
    const fluctuationsToggle = document.getElementById('fluctuationsToggle');

    // Buttons
    const collectDataBtn = document.getElementById('collectDataBtn');
    const resetBtn = document.getElementById('resetBtn');
    const exportBtn = document.getElementById('exportBtn');

    // Display elements
    const detectorReadout = document.getElementById('detectorReadout');
    const diagramVisual = document.getElementById('diagramVisual');
    const diagramLabels = document.getElementById('diagramLabels');
    const distanceLabel = document.getElementById('distanceLabel');
    const dataTableBody = document.getElementById('dataTableBody');
    const trialCounter = document.getElementById('trialCounter');
    const intensityChart = document.getElementById('intensityChart');
    const chartPlaceholder = document.getElementById('chartPlaceholder');

    // ==================== EVENT LISTENERS ====================
    // Help modal
    infoBtn.addEventListener('click', () => {
      helpOverlay.classList.add('active');
    });

    helpCloseBtn.addEventListener('click', () => {
      helpOverlay.classList.remove('active');
    });

    helpOverlay.addEventListener('click', (e) => {
      if (e.target === helpOverlay) {
        helpOverlay.classList.remove('active');
      }
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && helpOverlay.classList.contains('active')) {
        helpOverlay.classList.remove('active');
      }
    });

    modeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        modeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        appState.currentMode = btn.dataset.mode;
        updateModeUI();
      });
    });

    distanceSlider.addEventListener('input', (e) => {
      distanceValue.textContent = e.target.value;
      updateDiagramDistance();
    });

    timeSlider.addEventListener('input', (e) => {
      timeValue.textContent = e.target.value;
    });

    sourceBarrierSlider.addEventListener('input', (e) => {
      sourceBarrierValue.textContent = e.target.value;
      updateDiagramDistance();
    });

    thicknessSlider.addEventListener('input', (e) => {
      thicknessValue.textContent = parseFloat(e.target.value).toFixed(1);
    });

    barrierDetectorSlider.addEventListener('input', (e) => {
      barrierDetectorValue.textContent = e.target.value;
      updateDiagramDistance();
    });

    timeSliderBarrier.addEventListener('input', (e) => {
      timeValueBarrier.textContent = e.target.value;
    });

    [backgroundToggle, fluctuationsToggle].forEach(toggle => {
      toggle.addEventListener('click', () => {
        toggle.classList.toggle('active');
      });
    });

    collectDataBtn.addEventListener('click', collectData);
    resetBtn.addEventListener('click', resetData);
    exportBtn.addEventListener('click', exportCSV);

    // ==================== MODE MANAGEMENT ====================
    function updateModeUI() {
      if (appState.currentMode === 'distance-only') {
        distanceOnlyControls.classList.remove('hidden');
        barrierShieldingControls.classList.add('hidden');
        updateDiagramDistance();
      } else {
        distanceOnlyControls.classList.add('hidden');
        barrierShieldingControls.classList.remove('hidden');
        updateDiagramDistance();
      }
    }

    function updateDiagramDistance() {
      const diagramContainer = diagramVisual;
      const containerWidth = diagramContainer.offsetWidth - 60; // Subtract padding
      const detectorElement = diagramVisual.querySelector('.diagram-detector');
      const barrierElement = diagramVisual.querySelector('.diagram-barrier');
      
      // Common positioning logic - both modes use same scale
      const maxDistance = 50; // Maximum distance value for scaling
      
      let totalDistance, source_barrier_dist, barrier_detector_dist;
      
      if (appState.currentMode === 'distance-only') {
        totalDistance = parseInt(distanceSlider.value);
        source_barrier_dist = null;
        barrier_detector_dist = null;
        
        // Remove barrier if it exists
        if (barrierElement) {
          barrierElement.remove();
        }
      } else {
        source_barrier_dist = parseInt(sourceBarrierSlider.value);
        barrier_detector_dist = parseInt(barrierDetectorSlider.value);
        totalDistance = source_barrier_dist + barrier_detector_dist;
        
        // Create barrier if it doesn't exist
        let newBarrierElement = barrierElement;
        if (!newBarrierElement) {
          newBarrierElement = document.createElement('div');
          newBarrierElement.className = 'diagram-barrier';
          newBarrierElement.innerHTML = `
            <div class="barrier-icon">‚ñØ</div>
            <div class="icon-label">Barrier</div>
          `;
          diagramVisual.appendChild(newBarrierElement);
        }
        
        // Position barrier (at source_barrier distance from source)
        const barrierPercent = (source_barrier_dist / maxDistance) * 100;
        const barrierLeftPosition = (containerWidth / 100) * barrierPercent;
        newBarrierElement.style.left = (30 + barrierLeftPosition) + 'px';
        newBarrierElement.style.top = '50%';
        newBarrierElement.style.transform = 'translateY(-50%)';
      }
      
      // Position detector based on TOTAL distance (consistent in both modes)
      const detectorPercent = (totalDistance / maxDistance) * 100;
      const detectorLeftPosition = (containerWidth / 100) * detectorPercent;
      
      if (detectorElement) {
        detectorElement.style.left = (30 + detectorLeftPosition) + 'px';
        detectorElement.style.top = '50%';
        detectorElement.style.transform = 'translateY(-50%)';
      }
      
      // Update labels
      if (appState.currentMode === 'distance-only') {
        distanceLabel.textContent = `${totalDistance} cm`;
        diagramLabels.textContent = '';
      } else {
        distanceLabel.textContent = `${source_barrier_dist} + ${barrier_detector_dist} = ${totalDistance} cm`;
      }
    }

    // ==================== PHYSICS CALCULATIONS ====================
    function getRadiationType() {
      return radiationTypeSelect.value;
    }

    function getBackgroundCPS() {
      return backgroundToggle.classList.contains('active') ? PHYSICS.background_cps_value : 0.00;
    }

    function getRandomFluctuations() {
      return fluctuationsToggle.classList.contains('active');
    }

    function getTotalDistance() {
      if (appState.currentMode === 'distance-only') {
        return parseInt(distanceSlider.value);
      } else {
        return parseInt(sourceBarrierSlider.value) + parseInt(barrierDetectorSlider.value);
      }
    }

    function getMeasurementTime() {
      if (appState.currentMode === 'distance-only') {
        return parseInt(timeSlider.value);
      } else {
        return parseInt(timeSliderBarrier.value);
      }
    }

    // Poisson random number generator
    function poissonRandom(lambda) {
      if (lambda < 30) {
        // Knuth algorithm for small lambda
        let L = Math.exp(-lambda);
        let k = 0;
        let p = 1;
        while (p > L) {
          k++;
          p *= Math.random();
        }
        return k - 1;
      } else {
        // Normal approximation for large lambda
        return Math.max(0, Math.round(lambda + Math.sqrt(lambda) * normalRandom()));
      }
    }

    // Box-Muller normal random
    function normalRandom() {
      let u1, u2;
      do {
        u1 = Math.random();
      } while (u1 <= 1e-256);
      u2 = Math.random();
      return Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
    }

    function calculateMeasurement() {
      const type = getRadiationType();
      const r_total_cm = getTotalDistance();
      const measurement_time_s = getMeasurementTime();
      const background_cps = getBackgroundCPS();
      const useFluctuations = getRandomFluctuations();

      // Step 1: T_air
      const mu_air = PHYSICS.mu_air[type];
      const T_air = Math.exp(-mu_air * r_total_cm);

      // Step 2: T_barrier
      let T_barrier = 1;
      if (appState.currentMode === 'barrier-shielding') {
        const material = materialSelect.value;
        const thickness_mm = parseFloat(thicknessSlider.value);
        const thickness_cm = thickness_mm / 10;
        const mu_barrier_value = PHYSICS.mu_barrier[type][material];
        T_barrier = Math.exp(-mu_barrier_value * thickness_cm);
      }

      // Step 1: cps_source_expected
      let cps_source_expected = PHYSICS.S0[type] * Math.pow(PHYSICS.r0 / r_total_cm, 2) * T_air * T_barrier;

      // Alpha range cutoff
      if (type === 'alpha' && r_total_cm > PHYSICS.alpha_range_cutoff) {
        cps_source_expected = 0;
      }

      // Step 2: cps_measured_expected
      const cps_measured_expected = cps_source_expected + background_cps;

      // Step 3: expected_counts
      const expected_counts = cps_measured_expected * measurement_time_s;

      // Step 4: measured_counts
      let measured_counts;
      if (useFluctuations) {
        measured_counts = poissonRandom(expected_counts);
      } else {
        measured_counts = Math.round(expected_counts);
      }

      // Step 5: measured_cps
      const measured_cps = measured_counts / measurement_time_s;

      // Step 6: corr_cps
      const corr_cps = Math.max(0, measured_cps - background_cps);

      return {
        measured_counts: measured_counts,
        measured_cps: measured_cps.toFixed(2),
        background_cps: background_cps.toFixed(2),
        corr_cps: corr_cps.toFixed(2)
      };
    }

    // ==================== DATA COLLECTION ====================
    function collectData() {
      const type = getRadiationType();
      const mode = appState.currentMode === 'distance-only' ? 'Distance' : 'Barrier';
      const distance = getTotalDistance();
      const time = getMeasurementTime();

      // Disable button and show measurement overlay
      collectDataBtn.disabled = true;
      const measurementOverlay = document.getElementById('measurementOverlay');
      const measurementTimer = document.getElementById('measurementTimer');
      const liveCount = document.getElementById('liveCount');
      const liveCps = document.getElementById('liveCps');
      const progressFill = document.getElementById('progressFill');

      measurementOverlay.classList.add('active');

      // Calculate the expected counts per second
      const expectedCPS = calculateExpectedCPS();

      let totalCounts = 0;
      let startTime = Date.now();
      let lastUpdateTime = startTime;

      // Update display every 100ms
      const updateInterval = setInterval(() => {
        const elapsedMs = Date.now() - startTime;
        const elapsedSeconds = elapsedMs / 1000;

        if (elapsedSeconds >= time) {
          // Measurement complete
          clearInterval(updateInterval);
          measurementOverlay.classList.remove('active');
          collectDataBtn.disabled = false;

          // Calculate final measurement
          const measurement = calculateMeasurement();

          let material = '-';
          let thickness = '-';
          if (appState.currentMode === 'barrier-shielding') {
            material = materialSelect.value.charAt(0).toUpperCase() + materialSelect.value.slice(1);
            thickness = parseFloat(thicknessSlider.value).toFixed(1);
          }

          const trial = {
            trial_num: appState.trials.length + 1,
            type: type.charAt(0).toUpperCase() + type.slice(1),
            mode: mode,
            distance: distance,
            material: material,
            thickness: thickness,
            time: time,
            counts: measurement.measured_counts,
            cps: measurement.measured_cps,
            background: measurement.background_cps,
            corr_cps: measurement.corr_cps
          };

          appState.trials.push(trial);
          updateTable();
          updateChart();
          updateDetectorReadout();
          return;
        }

        // Update timer display
        measurementTimer.textContent = elapsedSeconds.toFixed(1) + 's';

        // Generate counts for this interval
        const timeDelta = (elapsedMs - (lastUpdateTime - startTime)) / 1000;
        const countsInInterval = poissonRandom(expectedCPS * timeDelta);
        totalCounts += countsInInterval;
        lastUpdateTime = Date.now();

        // Update live display
        liveCount.textContent = totalCounts;
        const currentCPS = totalCounts / elapsedSeconds;
        liveCps.textContent = currentCPS.toFixed(2);

        // Update progress bar
        const progressPercent = (elapsedSeconds / time) * 100;
        progressFill.style.width = progressPercent + '%';
      }, 100);
    }

    function calculateExpectedCPS() {
      const type = getRadiationType();
      const r_total_cm = getTotalDistance();
      const background_cps = getBackgroundCPS();

      // T_air
      const mu_air = PHYSICS.mu_air[type];
      const T_air = Math.exp(-mu_air * r_total_cm);

      // T_barrier
      let T_barrier = 1;
      if (appState.currentMode === 'barrier-shielding') {
        const material = materialSelect.value;
        const thickness_mm = parseFloat(thicknessSlider.value);
        const thickness_cm = thickness_mm / 10;
        const mu_barrier_value = PHYSICS.mu_barrier[type][material];
        T_barrier = Math.exp(-mu_barrier_value * thickness_cm);
      }

      // cps_source_expected
      let cps_source_expected = PHYSICS.S0[type] * Math.pow(PHYSICS.r0 / r_total_cm, 2) * T_air * T_barrier;

      // Alpha range cutoff
      if (type === 'alpha' && r_total_cm > PHYSICS.alpha_range_cutoff) {
        cps_source_expected = 0;
      }

      return cps_source_expected + background_cps;
    }

    function updateDetectorReadout() {
      if (appState.trials.length > 0) {
        const lastTrial = appState.trials[appState.trials.length - 1];
        detectorReadout.textContent = `${lastTrial.cps} cps`;
      }
    }

    function updateTable() {
      dataTableBody.innerHTML = '';
      appState.trials.forEach(trial => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${trial.trial_num}</td>
          <td>${trial.type}</td>
          <td>${trial.mode}</td>
          <td>${trial.distance}</td>
          <td>${trial.material}</td>
          <td>${trial.thickness}</td>
          <td>${trial.time}</td>
          <td>${trial.counts}</td>
          <td>${trial.cps}</td>
          <td>${trial.background}</td>
          <td>${trial.corr_cps}</td>
        `;
        dataTableBody.appendChild(row);
      });
      trialCounter.textContent = `${appState.trials.length} trials`;
    }

    function updateChart() {
      // Rebuild chart data
      appState.chartData = { gamma: [], alpha: [], beta: [] };
      appState.trials.forEach(trial => {
        const typeKey = trial.type.toLowerCase();
        appState.chartData[typeKey].push({
          x: trial.distance,
          y: parseFloat(trial.corr_cps)
        });
      });

      // Sort by distance for cleaner lines
      Object.keys(appState.chartData).forEach(key => {
        appState.chartData[key].sort((a, b) => a.x - b.x);
      });

      if (appState.trials.length > 0) {
        if (!appState.chart) {
          initializeChart();
        } else {
          appState.chart.data.datasets[0].data = appState.chartData.gamma;
          appState.chart.data.datasets[1].data = appState.chartData.alpha;
          appState.chart.data.datasets[2].data = appState.chartData.beta;
          appState.chart.update();
        }
        chartPlaceholder.classList.add('hidden');
        intensityChart.classList.remove('hidden');
      }
    }

    function initializeChart() {
      intensityChart.classList.remove('hidden');
      appState.chart = new Chart(intensityChart, {
        type: 'scatter',
        data: {
          datasets: [
            {
              label: 'Gamma (Œ≥)',
              data: appState.chartData.gamma,
              borderColor: '#b366ff',
              backgroundColor: 'rgba(179, 102, 255, 0.1)',
              borderWidth: 2,
              pointRadius: 5,
              pointBackgroundColor: '#b366ff',
              pointBorderColor: '#fff',
              pointBorderWidth: 1,
              showLine: true,
              tension: 0.1
            },
            {
              label: 'Alpha (Œ±)',
              data: appState.chartData.alpha,
              borderColor: '#ff6b6b',
              backgroundColor: 'rgba(255, 107, 107, 0.1)',
              borderWidth: 2,
              pointRadius: 5,
              pointBackgroundColor: '#ff6b6b',
              pointBorderColor: '#fff',
              pointBorderWidth: 1,
              showLine: true,
              tension: 0.1
            },
            {
              label: 'Beta (Œ≤)',
              data: appState.chartData.beta,
              borderColor: '#4ecdc4',
              backgroundColor: 'rgba(78, 205, 196, 0.1)',
              borderWidth: 2,
              pointRadius: 5,
              pointBackgroundColor: '#4ecdc4',
              pointBorderColor: '#fff',
              pointBorderWidth: 1,
              showLine: true,
              tension: 0.1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              labels: {
                color: '#ccc',
                font: { size: 11 },
                padding: 15,
                usePointStyle: true
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleColor: '#00ff96',
              bodyColor: '#ccc',
              borderColor: 'rgba(0, 255, 150, 0.5)',
              borderWidth: 1,
              padding: 8,
              displayColors: true,
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: ${context.parsed.y.toFixed(2)} cps`;
                },
                afterLabel: function(context) {
                  return `Distance: ${context.parsed.x} cm`;
                }
              }
            }
          },
          scales: {
            x: {
              type: 'linear',
              title: {
                display: true,
                text: 'Distance (cm)',
                color: '#00ff96',
                font: { weight: 'bold', size: 12 }
              },
              ticks: { color: '#aaa', font: { size: 11 } },
              grid: { color: 'rgba(0, 255, 150, 0.1)' }
            },
            y: {
              title: {
                display: true,
                text: 'Intensity (cps)',
                color: '#00ff96',
                font: { weight: 'bold', size: 12 }
              },
              ticks: { color: '#aaa', font: { size: 11 } },
              grid: { color: 'rgba(0, 255, 150, 0.1)' }
            }
          }
        }
      });
    }

    function resetData() {
      appState.trials = [];
      appState.chartData = { gamma: [], alpha: [], beta: [] };
      dataTableBody.innerHTML = '';
      trialCounter.textContent = '0 trials';
      detectorReadout.textContent = '0.00 cps';
      if (appState.chart) {
        appState.chart.destroy();
        appState.chart = null;
      }
      chartPlaceholder.classList.remove('hidden');
      intensityChart.classList.add('hidden');
      showToast('Data reset');
    }

    function exportCSV() {
      if (appState.trials.length === 0) {
        showToast('No data to export');
        return;
      }

      const headers = ['Trial', 'Type', 'Mode', 'Distance(cm)', 'Material', 'Thick.(mm)', 'Time(s)', 'Counts', 'cps', 'Bkgd(cps)', 'Corr. cps'];
      const rows = appState.trials.map(trial => [
        trial.trial_num,
        trial.type,
        trial.mode,
        trial.distance,
        trial.material,
        trial.thickness,
        trial.time,
        trial.counts,
        trial.cps,
        trial.background,
        trial.corr_cps
      ]);

      const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'radiation_lab_data.csv';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      showToast('CSV exported successfully');
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // ==================== INITIALIZATION ====================
    updateModeUI();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c451460c7f58d09',t:'MTc2OTQ4MzY2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>